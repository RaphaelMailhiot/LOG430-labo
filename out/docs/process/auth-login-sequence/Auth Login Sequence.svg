<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1512px" preserveAspectRatio="none" style="width:1070px;height:1512px;" version="1.1" viewBox="0 0 1070 1512" width="1070px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="195.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="332" y="162.3125"/><rect fill="#FFFFFF" height="915.1641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="332" y="432.125"/><rect fill="#FFFFFF" height="73.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="332" y="1413.9922"/><rect fill="#FFFFFF" height="91.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="192.6641"/><rect fill="#FFFFFF" height="116.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="462.4766"/><rect fill="#FFFFFF" height="91.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="677.9375"/><rect fill="#FFFFFF" height="91.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="888.8828"/><rect fill="#FFFFFF" height="91.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="1167.5313"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="885" y="223.0156"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="885" y="708.2891"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="885" y="919.2344"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="885" y="1197.8828"/><rect fill="#FFFFFF" height="854.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="991.5" y="492.8281"/><rect fill="#FFFFFF" height="832.4609" style="stroke:#000000;stroke-width:2.0;" width="1043.5" x="10" y="507.8281"/><rect fill="#FFFFFF" height="424.4063" style="stroke:#000000;stroke-width:2.0;" width="929.5" x="20" y="637.2344"/><rect fill="#FFFFFF" height="210.9453" style="stroke:none;stroke-width:1.0;" width="929.5" x="20" y="850.6953"/><rect fill="#FFFFFF" height="271.6484" style="stroke:none;stroke-width:1.0;" width="1043.5" x="10" y="1068.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="64" x2="64" y1="85.6094" y2="1505.6953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="337" x2="337" y1="85.6094" y2="1505.6953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="666.5" x2="666.5" y1="85.6094" y2="1505.6953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="889.5" x2="889.5" y1="85.6094" y2="1505.6953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="996.5" x2="996.5" y1="85.6094" y2="1505.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="30" y="82.5332">Utilisateur</text><ellipse cx="64" cy="15" fill="#FEFECE" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M64,23 L64,50 M51,31 L77,31 M64,50 L51,65 M64,50 L77,65 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="72" x="301" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="308" y="74.5332">Frontend</text><rect fill="#FEFECE" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="131" x="601.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="608.5" y="74.5332">Kong API Gateway</text><rect fill="#FEFECE" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="99" x="840.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="847.5" y="74.5332">Store Service</text><rect fill="#FEFECE" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="94" x="949.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="956.5" y="74.5332">Auth Service</text><rect fill="#FFFFFF" height="195.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="332" y="162.3125"/><rect fill="#FFFFFF" height="915.1641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="332" y="432.125"/><rect fill="#FFFFFF" height="73.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="332" y="1413.9922"/><rect fill="#FFFFFF" height="91.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="192.6641"/><rect fill="#FFFFFF" height="116.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="462.4766"/><rect fill="#FFFFFF" height="91.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="677.9375"/><rect fill="#FFFFFF" height="91.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="888.8828"/><rect fill="#FFFFFF" height="91.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="662" y="1167.5313"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="885" y="223.0156"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="885" y="708.2891"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="885" y="919.2344"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="885" y="1197.8828"/><rect fill="#FFFFFF" height="854.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="991.5" y="492.8281"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1063.5" x="0" y="116.7852"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1063.5" y1="116.7852" y2="116.7852"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1063.5" y1="119.7852" y2="119.7852"/><rect fill="#EEEEEE" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="241" x="411.25" y="105.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="223" x="417.25" y="123.1045">Affichage de la page de connexion</text><polygon fill="#A80036" points="320,158.3125,330,162.3125,320,166.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="326" y1="162.3125" y2="162.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="71" y="157.4561">GET /login</text><polygon fill="#A80036" points="650,188.6641,660,192.6641,650,196.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="656" y1="192.6641" y2="192.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="349" y="187.8076">GET /store/api/v1/stores</text><polygon fill="#A80036" points="873,219.0156,883,223.0156,873,227.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="672" x2="879" y1="223.0156" y2="223.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="679" y="218.1592">GET /api/v1/stores</text><polygon fill="#A80036" points="683,249.3672,673,253.3672,683,257.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="677" x2="889" y1="253.3672" y2="253.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="689" y="248.5107">Liste des magasins</text><polygon fill="#A80036" points="353,279.7188,343,283.7188,353,287.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="666" y1="283.7188" y2="283.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="359" y="278.8623">Liste des magasins</text><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="384" y1="314.0703" y2="314.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="384" x2="384" y1="314.0703" y2="327.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="384" y1="327.0703" y2="327.0703"/><polygon fill="#A80036" points="353,323.0703,343,327.0703,353,331.0703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="349" y="309.2139">Rendu de login.ejs avec les magasins</text><polygon fill="#A80036" points="75,353.4219,65,357.4219,75,361.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="336" y1="357.4219" y2="357.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="81" y="352.5654">Page de connexion avec formulaire</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1063.5" x="0" y="386.5977"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1063.5" y1="386.5977" y2="386.5977"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1063.5" y1="389.5977" y2="389.5977"/><rect fill="#EEEEEE" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="272" x="395.75" y="375.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="254" x="401.75" y="392.917">Soumission du formulaire de connexion</text><polygon fill="#A80036" points="320,428.125,330,432.125,320,436.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="326" y1="432.125" y2="432.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="71" y="427.2686">POST /login (email, password, storeId)</text><polygon fill="#A80036" points="650,458.4766,660,462.4766,650,466.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="656" y1="462.4766" y2="462.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="349" y="457.6201">GET /auth/api/v1/users/{email}/password/{password}</text><polygon fill="#A80036" points="979.5,488.8281,989.5,492.8281,979.5,496.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="672" x2="985.5" y1="492.8281" y2="492.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="679" y="487.9717">GET /api/v1/users/{email}/password/{password}</text><path d="M10,507.8281 L71,507.8281 L71,515.8281 L61,525.8281 L10,525.8281 L10,507.8281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="832.4609" style="stroke:#000000;stroke-width:2.0;" width="1043.5" x="10" y="507.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="522.3232">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="103" x="86" y="521.2471">[Utilisateur trouvé]</text><polygon fill="#A80036" points="683,544.5313,673,548.5313,683,552.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="677" x2="990.5" y1="548.5313" y2="548.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="689" y="543.6748">Données utilisateur</text><polygon fill="#A80036" points="353,574.8828,343,578.8828,353,582.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="666" y1="578.8828" y2="578.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="359" y="574.0264">Données utilisateur</text><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="384" y1="609.2344" y2="609.2344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="384" x2="384" y1="609.2344" y2="622.2344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="384" y1="622.2344" y2="622.2344"/><polygon fill="#A80036" points="353,618.2344,343,622.2344,353,626.2344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="349" y="604.3779">Stockage en session (user, isManager)</text><path d="M20,637.2344 L81,637.2344 L81,645.2344 L71,655.2344 L20,655.2344 L20,637.2344 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="424.4063" style="stroke:#000000;stroke-width:2.0;" width="929.5" x="20" y="637.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="651.7295">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="241" x="96" y="650.6533">[Utilisateur est manager (store_id présent)]</text><polygon fill="#A80036" points="650,673.9375,660,677.9375,650,681.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="656" y1="677.9375" y2="677.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="349" y="673.0811">GET /store/api/v1/stores/{user.store_id}</text><polygon fill="#A80036" points="873,704.2891,883,708.2891,873,712.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="672" x2="879" y1="708.2891" y2="708.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="679" y="703.4326">GET /api/v1/stores/{user.store_id}</text><polygon fill="#A80036" points="683,734.6406,673,738.6406,683,742.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="677" x2="889" y1="738.6406" y2="738.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="689" y="733.7842">Données du magasin</text><polygon fill="#A80036" points="353,764.9922,343,768.9922,353,772.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="666" y1="768.9922" y2="768.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="359" y="764.1357">Données du magasin</text><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="384" y1="799.3438" y2="799.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="384" x2="384" y1="799.3438" y2="812.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="384" y1="812.3438" y2="812.3438"/><polygon fill="#A80036" points="353,808.3438,343,812.3438,353,816.3438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="349" y="794.4873">Stockage en session (selectedStore)</text><polygon fill="#A80036" points="75,838.6953,65,842.6953,75,846.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="331" y1="842.6953" y2="842.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="81" y="837.8389">Redirection vers /dashboard</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="949.5" y1="851.6953" y2="851.6953"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="215" x="25" y="863.1143">[Utilisateur est client (pas de store_id)]</text><polygon fill="#A80036" points="650,884.8828,660,888.8828,650,892.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="656" y1="888.8828" y2="888.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="349" y="884.0264">GET /store/api/v1/stores/{storeId}</text><polygon fill="#A80036" points="873,915.2344,883,919.2344,873,923.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="672" x2="879" y1="919.2344" y2="919.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="679" y="914.3779">GET /api/v1/stores/{storeId}</text><polygon fill="#A80036" points="683,945.5859,673,949.5859,683,953.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="677" x2="889" y1="949.5859" y2="949.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="689" y="944.7295">Données du magasin</text><polygon fill="#A80036" points="353,975.9375,343,979.9375,353,983.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="666" y1="979.9375" y2="979.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="359" y="975.0811">Données du magasin</text><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="384" y1="1010.2891" y2="1010.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="384" x2="384" y1="1010.2891" y2="1023.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="384" y1="1023.2891" y2="1023.2891"/><polygon fill="#A80036" points="353,1019.2891,343,1023.2891,353,1027.2891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="349" y="1005.4326">Stockage en session (selectedStore)</text><polygon fill="#A80036" points="75,1049.6406,65,1053.6406,75,1057.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="331" y1="1053.6406" y2="1053.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="81" y="1048.7842">Redirection vers /</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1053.5" y1="1069.6406" y2="1069.6406"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="127" x="15" y="1081.0596">[Utilisateur non trouvé]</text><polygon fill="#A80036" points="678,1102.8281,668,1106.8281,678,1110.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="672" x2="990.5" y1="1106.8281" y2="1106.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="684" y="1101.9717">false</text><polygon fill="#A80036" points="353,1133.1797,343,1137.1797,353,1141.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="666" y1="1137.1797" y2="1137.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="359" y="1132.3232">false</text><polygon fill="#A80036" points="650,1163.5313,660,1167.5313,650,1171.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="656" y1="1167.5313" y2="1167.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="349" y="1162.6748">GET /store/api/v1/stores</text><polygon fill="#A80036" points="873,1193.8828,883,1197.8828,873,1201.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="672" x2="879" y1="1197.8828" y2="1197.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="679" y="1193.0264">GET /api/v1/stores</text><polygon fill="#A80036" points="683,1224.2344,673,1228.2344,683,1232.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="677" x2="889" y1="1228.2344" y2="1228.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="689" y="1223.3779">Liste des magasins</text><polygon fill="#A80036" points="353,1254.5859,343,1258.5859,353,1262.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="666" y1="1258.5859" y2="1258.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="359" y="1253.7295">Liste des magasins</text><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="384" y1="1288.9375" y2="1288.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="384" x2="384" y1="1288.9375" y2="1301.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="384" y1="1301.9375" y2="1301.9375"/><polygon fill="#A80036" points="353,1297.9375,343,1301.9375,353,1305.9375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="349" y="1284.0811">Rendu de login.ejs avec erreur</text><polygon fill="#A80036" points="75,1328.2891,65,1332.2891,75,1336.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="331" y1="1332.2891" y2="1332.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="81" y="1327.4326">Page de connexion avec message d'erreur</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1063.5" x="0" y="1368.4648"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1063.5" y1="1368.4648" y2="1368.4648"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1063.5" y1="1371.4648" y2="1371.4648"/><rect fill="#EEEEEE" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="102" x="480.75" y="1357.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="84" x="486.75" y="1374.7842">Déconnexion</text><polygon fill="#A80036" points="320,1409.9922,330,1413.9922,320,1417.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="64" x2="326" y1="1413.9922" y2="1413.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="71" y="1409.1357">POST /logout</text><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="384" y1="1444.3438" y2="1444.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="384" x2="384" y1="1444.3438" y2="1457.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="384" y1="1457.3438" y2="1457.3438"/><polygon fill="#A80036" points="353,1453.3438,343,1457.3438,353,1461.3438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="349" y="1439.4873">Nettoyage de la session</text><polygon fill="#A80036" points="75,1483.6953,65,1487.6953,75,1491.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="336" y1="1487.6953" y2="1487.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="81" y="1482.8389">Redirection vers /login</text><!--MD5=[be4dc812752f6c5d92c127fc8edcab09]
@startuml Auth Login Sequence

skinparam style strictuml

actor "Utilisateur" as User
participant "Frontend" as Frontend
participant "Kong API Gateway" as Kong
participant "Store Service" as StoreService
participant "Auth Service" as AuthService

== Affichage de la page de connexion ==

User -> Frontend: GET /login
activate Frontend

Frontend -> Kong: GET /store/api/v1/stores
activate Kong
Kong -> StoreService: GET /api/v1/stores
activate StoreService
StoreService - -> Kong: Liste des magasins
deactivate StoreService
Kong - -> Frontend: Liste des magasins
deactivate Kong

Frontend -> Frontend: Rendu de login.ejs avec les magasins
Frontend - -> User: Page de connexion avec formulaire
deactivate Frontend

== Soumission du formulaire de connexion ==

User -> Frontend: POST /login (email, password, storeId)
activate Frontend

Frontend -> Kong: GET /auth/api/v1/users/{email}/password/{password}
activate Kong
Kong -> AuthService: GET /api/v1/users/{email}/password/{password}
activate AuthService

alt Utilisateur trouvé
    AuthService - -> Kong: Données utilisateur
    Kong - -> Frontend: Données utilisateur
    deactivate Kong
    
    Frontend -> Frontend: Stockage en session (user, isManager)
    
    alt Utilisateur est manager (store_id présent)
        Frontend -> Kong: GET /store/api/v1/stores/{user.store_id}
        activate Kong
        Kong -> StoreService: GET /api/v1/stores/{user.store_id}
        activate StoreService
        StoreService - -> Kong: Données du magasin
        deactivate StoreService
        Kong - -> Frontend: Données du magasin
        deactivate Kong
        
        Frontend -> Frontend: Stockage en session (selectedStore)
        Frontend - -> User: Redirection vers /dashboard
    else Utilisateur est client (pas de store_id)
        Frontend -> Kong: GET /store/api/v1/stores/{storeId}
        activate Kong
        Kong -> StoreService: GET /api/v1/stores/{storeId}
        activate StoreService
        StoreService - -> Kong: Données du magasin
        deactivate StoreService
        Kong - -> Frontend: Données du magasin
        deactivate Kong
        
        Frontend -> Frontend: Stockage en session (selectedStore)
        Frontend - -> User: Redirection vers /
    end
    
else Utilisateur non trouvé
    AuthService - -> Kong: false
    Kong - -> Frontend: false
    deactivate Kong
    
    Frontend -> Kong: GET /store/api/v1/stores
    activate Kong
    Kong -> StoreService: GET /api/v1/stores
    activate StoreService
    StoreService - -> Kong: Liste des magasins
    deactivate StoreService
    Kong - -> Frontend: Liste des magasins
    deactivate Kong
    
    Frontend -> Frontend: Rendu de login.ejs avec erreur
    Frontend - -> User: Page de connexion avec message d'erreur
end

deactivate AuthService
deactivate Frontend

== Déconnexion ==

User -> Frontend: POST /logout
activate Frontend
Frontend -> Frontend: Nettoyage de la session
Frontend - -> User: Redirection vers /login
deactivate Frontend

@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: CA
--></g></svg>